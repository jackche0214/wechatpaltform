define("view/index/NewRevealView",["require","pro","model/WinRecordModel","common/Utils","common/Countdown"],function(e){function t(e){}var n=e("pro"),i=e("model/WinRecordModel"),o=(e("common/Utils"),e("common/Countdown"));return n.View.extend(t,{ItemView:n.View.extend(function(){this.listen("render",function(){var e=this;if(e.doms.countdown){var t=null;new o({now:G.serverTime,interval:40,expires:e.model.get("remainTime"),listeners:{run:function(n){t={m:n.m,s:n.s,ms:n.ms.substring(0,2)},e.doms.countdown.innerHTML=t.m+":"+t.s+"."+t.ms},finish:function(){t=null,e.getParent().fire("countdownfinish",e)}}}).start()}})},{Model:i,_template:['<li class="w-goodsList-item">','<div class="w-goods w-goods-brief">','<div class="w-goods-pic">','<a href="{{gurl}}">','<img src="" data-src="{{smallPic}}" onerror="this.src=\''+G.url+"lib/img/products/square/s.png'\" />","</a>","</div>","{{#isCounting}}","{{#isErr}}",'<div class="w-countWaiting"><span class="txt-gray">福彩通信错误...</span></div>',"{{/isErr}}","{{^isErr}}",'<div class="w-countdown" data-pro="countdownWrap">','<span class="w-countdown-title">倒计时</span><span data-pro="countdown" data-time="{{remainTime}}" class="w-countdown-nums"></span>',"</div>",'<div class="w-countWaiting" data-pro="countdownWaiting" style="display:none">正在计算...</div>',"{{/isErr}}","{{/isCounting}}",'{{^isCounting}}<p class="w-goods-user f-txtabb">恭喜<a href="{{owner.userpage}}">{{owner.nickname}}</a>获得</p>{{/isCounting}}',"</div>","</li>"].join(""),_doms:{countdown:"@countdown",countdownWrap:"@countdownWrap",countdownWaiting:"@countdownWaiting"}}),_template:['<ul class="m-index-reveal-list w-goodsList-brief" data-pro="entry"></ul>'].join(""),_entry:"@entry"},{oncreate:function(){for(var e=this.__config,t=this.Class,n=e.items.list,i=0,o=n.length;o>i;i++){var a=n[i];new t.ItemView({data:a}).join(this).render(this)}}})}),define("controller/index/Index",["require","$","pro","controller/CommonController","action/IndexAction","view/index/NewRevealView","common/Lazyload","common/Utils","common/SpecialSupport","ui/SlideShow"],function(e){function t(){var e=this,t=c(".m-index-promot"),n=p.from(t[0],{width:t.width(),hasBtn:!1,onafterrender:function(){var e=this;c(window).on("resize",function(){e.init(t.width())})}});"release"==G.environment&&(this.bannerShownFrames=[],this.listen(n,"slideChange",function(t){e.onBannerSlideChange(t,n)}),this.listen(n,"slideCLick",function(t,n){e.onBannerSlideClick(n)}),n.fire("slideChange")),n.start()}function n(){var e=this;e._action.ajax("newReveal",null,function(t){var n=new f({items:t.result}).render(c(".m-index-reveal .m-index-mod-bd")[0]);if(t.result.list.length<3)for(var i=3-t.result.list.length;i>0;i--)c(".m-index-reveal-list").append('<li class="w-goodsList-item"><img style="margin:10px auto 0;max-width:100px;" src="'+G.url+'lib/img/common/alt_will_blank.jpg" /></li>');e.reLazyload(),n.listen("countdownfinish",function(t){t.doms.countdownWrap.style.display="none",t.doms.countdownWaiting.style.display="block",e._action.ajax("getWinner",{gid:t.model.get("gid"),period:t.model.get("period")},function(n){n.code-0==0&&n.result.luckyCode&&""!=n.result.luckyCode?(t.update(n.result),e.reLazyload()):t.doms.countdownWaiting.innerHTML='<span class="txt-gray">请稍后重试...</span>'})})})}function i(){var e=this,t=e.miniCart,n=c(".w-button-addToCart");n.each(function(){var e=c(this);e.bind("click",function(n){var i=e.parents(".w-goods"),o={gid:i.attr("data-gid")-0,period:i.attr("data-period")-0},a=1,r=i.attr("data-price"),s=i.attr("data-priceUnit"),d=i.attr("data-buyUnit");d>1?a=d:1==s&&(r>3500&&5e3>r?a=5:r>=5e3&&(a=10)),t.add(o.gid,o.period,a,function(){var n=20,i=c(t.view.dom),o=e.parents(".w-goods").find("img"),a=c('<img width="'+o.offset().width+'" src="'+o.attr("src")+'" />');a.css({position:"absolute",top:o.offset().top,left:o.offset().left,"z-index":3}),c("body").append(a);var r=(a.offset().left-i.offset().left-i.offset().width/2)/n,s=(a.offset().top-i.offset().top-i.offset().height/2)/n,d=a.width()/n,l=a.height()/n;u&&clearInterval(u);var u=setInterval(function(){a.offset().width>0?a.css({top:a.offset().top-s,left:a.offset().left-r,width:a.offset().width-d,height:a.offset().height-l}):(u&&clearInterval(u),a.remove())},n)}),o=null,n.stopPropagation()})})}function o(){var e=c(".m-index-popular-list .w-goods, .m-index-recommend .w-goods");e.each(function(){var e=c(this);e.on("click",function(){window.location.href=w.getGoodsUrl(e.attr("data-gid"),e.attr("data-period"))})})}function a(){var e=this;e._lazyload&&(e._lazyload.destroy(),e._lazyload=null),e._lazyload=new g}function r(){var e=this;e.initBackToTop(),e.renderMiniCart(),e._lazyload=new g,e._action=new m,e.showPromot(),e.getRevealGoods(),e.renderBuy(),e.bigClick(),e.renderAdvertising(),G.isLogin&&(e.getNewestReward(),e.getBonusAmount()),e.setCookie(),e.callSpecial("index",function(e){e.init&&e.init()})}function s(){var e=document.getElementById("advertising");if(e){for(var t=e.getElementsByTagName("ul")[0],n=t.getElementsByTagName("li"),i=0,o=0,a=0,r=n.length;r>a;a++){var s=n[a],d=s.getElementsByTagName("img")[0];d.width=d.width/2,i+=s.offsetWidth,s.offsetHeight>o&&(o=s.offsetHeight)}e.style.height=o+"px",t.style.width=i+"px",t.style.left="0px";var l=0,u=0,m=0,f=0,g=i-e.offsetWidth;c(t).on("touchstart",function(e){m=l=e.touches[0].pageX,f=u=e.touches[0].pageY}),c(t).on("touchmove",function(e){var n=e.touches[0].pageX,i=e.touches[0].pageY,o=n-m,a=parseInt(t.style.left)+o;return a>=0&&(a=0),-g>=a&&(a=-g),t.style.left=a+"px",m=n,Math.abs(l-n)>Math.abs(u-i)?!1:void 0}),c(t).on("touchend",function(e){})}}function d(e,t){var n=this.bannerShownFrames;if(n[t.frame])n.length==t.model.get("listLength")&&t.unlisten("slideChange");else{var i="";i=e?"click":"change";var o=t.itemsDom[t.frame],a=o.getAttribute("data-statistics").replace(/'/g,'"'),r=JSON.parse(a);r.eventType=i,r.cid=G.cid;var s={key:"indexBannerShow",segmentation:r};n[t.frame]=!0,Countly.q.push(["add_event",s])}}function l(e){var t=e.getAttribute("data-statistics").replace(/'/g,'"'),n=JSON.parse(t);n.cid=G.cid;var i={key:"indexBannerClick",segmentation:n};Countly.q.push(["add_event",i])}var c=e("$"),u=(e("pro"),e("controller/CommonController")),m=e("action/IndexAction"),f=e("view/index/NewRevealView"),g=e("common/Lazyload"),w=e("common/Utils"),h=e("common/SpecialSupport"),p=e("ui/SlideShow"),v=u.extend(r,{},{showPromot:t,getRevealGoods:n,renderBuy:i,bigClick:o,reLazyload:a,renderAdvertising:s,onBannerSlideChange:d,onBannerSlideClick:l,_lazyload:null,_action:null}).implement(h);return v}),define("hd/common/Index",["require","pro","hd/common/Base"],function(e){function t(){}var n=(e("pro"),e("hd/common/Base"));return n.extend(null,{init:t})});
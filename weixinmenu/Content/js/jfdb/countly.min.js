(function(G){var J=false,E=false,T="/i",e=500,N=[],s=[],I=[],c={},k=null,i=true,O,y=0,t=null,h=0,L=0,H=0,U=60,x=true,a,C=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,Q=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver|bingbot|Google Web Preview|Mediapartners-Google|AdsBot-Google|Baiduspider|Ezooms|YahooSeeker|AltaVista|AVSearch|Mercator|Scooter|InfoSeek|Ultraseek|Lycos|Wget|YandexBot|SiteBot|Exabot|AhrefsBot|MJ12bot|TurnitinBot|magpie-crawler|Nutch Crawler|CMS Crawler|rogerbot|Domnutch|ssearch_bot|XoviBot|netseer|digincore|fr-crawler)/,B=false,l=true,n;G.init=function(V){if(!J){n=u();J=true;N=d("cly_queue")||[];c=d("cly_timed")||{};V=V||{};e=V.interval||G.interval||e;U=V.fail_timeout||G.fail_timeout||U;G.debug=V.debug||G.debug||false;G.app_key=V.app_key||G.app_key||null;G.device_id=V.device_id||G.device_id||S();G.url=o(V.url||G.url||"https://cloud.count.ly");G.app_version=V.app_version||G.app_version||"0.0";G.country_code=V.country_code||G.country_code||null;G.city=V.city||G.city||null;G.ip_address=V.ip_address||G.ip_address||null;G.ignore_bots=V.ignore_bots||G.ignore_bots||true;G.q=G.q||[];q("Countly initialized");if(Q.test(navigator.userAgent)){B=true}if(G.q.constructor!==Array){G.q=[]}g();d("cly_id",G.device_id)}};G.begin_session=function(W){if(!E){q("Session started");O=u();E=true;i=(W)?false:true;var V={};V.begin_session=1;V.metrics=JSON.stringify(p());b(V)}};G.session_duration=function(V){if(E){q("Session extended",V);b({session_duration:V})}};G.end_session=function(V){if(E){V=V||u()-O;q("Ending session");A();E=false;b({end_session:1,session_duration:V});g()}};G.change_id=function(V,X){var W=G.device_id;G.device_id=V;d("cly_id",G.device_id);q("Changing id");if(X){b({old_device_id:W})}};G.add_event=function(X){if(!X.key){q("Event must have key property");return}if(!X.count){X.count=1}var W=["key","count","sum","dur","segmentation"];var Y=F(X,W);Y.timestamp=u();var V=new Date();Y.hour=V.getHours();Y.dow=V.getDay();s.push(Y);q("Adding event: ",X)};G.start_event=function(V){if(c[V]){q("Timed event with key "+V+" already started");return}c[V]=u();d("cly_timed",c)};G.end_event=function(V){if(typeof V=="string"){V={key:V}}if(!V.key){q("Event must have key property");return}if(!c[V.key]){q("Timed event with key "+key+" was not started");return}V.dur=u()-c[V.key];G.add_event(V);delete c[V.key];d("cly_timed",c)};G.user_details=function(V){q("Adding userdetails: ",V);var W=["name","username","email","organization","phone","picture","gender","byear","custom"];b({user_details:JSON.stringify(F(V,W))})};var R={};var K=function(W,X,V){if(!R[W]){R[W]={}}if(V=="$push"||V=="$pull"||V=="$addToSet"){if(!R[W][V]){R[W][V]=[]}R[W][V].push(X)}else{R[W][V]=X}};G.userData={set:function(V,W){R[V]=W},set_once:function(V,W){K(V,1,"$setOnce")},increment:function(V){K(V,1,"$inc")},increment_by:function(V,W){K(V,W,"$inc")},multiply:function(V,W){K(V,W,"$mul")},max:function(V,W){K(V,W,"$max")},min:function(V,W){K(V,W,"$min")},push:function(V,W){K(V,W,"$push")},push_unique:function(V,W){K(V,W,"$addToSet")},pull:function(V,W){K(V,W,"$pull")},save:function(){b({user_details:JSON.stringify({custom:R})});R={}}};G.track_errors=function(V){k=V;window.onerror=function(X,W,ae,Y,Z){if(typeof Z!=="undefined"){M(Z,false)}else{Y=Y||(window.event&&window.event.errorCharacter);var ac="";if(typeof X!=="undefined"){ac+=X+"\n"}if(typeof W!=="undefined"){ac+="at "+W}if(typeof ae!=="undefined"){ac+=":"+ae}if(typeof Y!=="undefined"){ac+=":"+Y}ac+="\n";try{var ad=[];var aa=arguments.callee.caller;while(aa){ad.push(aa.name);aa=aa.caller}ac+=ad.join("\n")}catch(ab){}M(ac,false)}}};G.log_error=function(W,V){M(W,true,V)};G.add_log=function(V){I.push(V)};G.stop_time=function(){l=false;y=u()-O;L=u()-h};G.start_time=function(){l=true;O=u()-y;h=u()-L;L=0};G.track_sessions=function(){G.begin_session();G.start_time();D(window,"beforeunload",function(){G.end_session()});D(window,"unload",function(){G.end_session()});var W="hidden";function V(){if(document[W]){G.stop_time()}else{G.start_time()}}if(W in document){document.addEventListener("visibilitychange",V)}else{if((W="mozHidden") in document){document.addEventListener("mozvisibilitychange",V)}else{if((W="webkitHidden") in document){document.addEventListener("webkitvisibilitychange",V)}else{if((W="msHidden") in document){document.addEventListener("msvisibilitychange",V)}else{if("onfocusin" in document){D(window,"focusin",function(){G.start_time()});D(window,"focusout",function(){G.stop_time()})}else{D(window,"focus",function(){G.start_time()});D(window,"blur",function(){G.stop_time()});D(window,"pageshow",function(){G.start_time()});D(window,"pagehide",function(){G.stop_time()})}}}}}};G.track_pageview=function(X){A();X=X||window.location.pathname;t=X;h=u();if(!a){p()}var V={name:X,visit:1,segment:a,domain:window.location.hostname};if(typeof document.referrer!=="undefined"&&document.referrer.length){var W=C.exec(document.referrer);if(W&&W[11]&&W[11]!=window.location.hostname){V.start=1}}G.add_event({key:"[CLY]_view",segmentation:V})};G.track_clicks=function(){var W=true;function V(Z){if(W){W=false;r(Z);if(typeof Z.pageX!=="undefined"&&typeof Z.pageY!=="undefined"){var X=m();var Y=P();G.add_event({key:"[CLY]_action",segmentation:{type:"click",x:Z.pageX,y:Z.pageY,width:Y,height:X,domain:window.location.hostname}})}setTimeout(function(){W=true},1000)}}D(document,"mousedown",V);D(document,"mouseup",V);D(document,"click",V)};G.track_links=function(V){V=V||document;function W(){function Z(ac){var ab=f(ac);r(ac);G.add_event({key:"linkClick",segmentation:{href:ab.href,text:ab.innerText,id:ab.id,x:ac.pageX,y:ac.pageY}});if(typeof ab.href!=="undefined"&&ab.target!=="_blank"&&!(ac.metaKey||ac.altKey||ac.ctrlKey||ac.shiftKey)){var aa=ab.href.replace(window.location.href.split("#")[0],"");if(aa.indexOf("#")!==0){G.end_session();j(ac);setTimeout(function(){window.location.href=ab.href},1000)}}}if(typeof V.getElementsByTagName!=="undefined"){var X=V.getElementsByTagName("a");for(var Y=0;Y<X.length;Y++){D(X[Y],"click",Z)}}else{q("Can't track clicks")}}if(document.readyState==="complete"){W()}else{D(window,"load",W)}};G.track_forms=function(W){W=W||document;function V(Z){return Z.name||Z.id||Z.type||Z.nodeName}function Y(aa){var Z=false;D(aa,"submit",function(ag){if(!Z){Z=true;var ad={id:aa.id,name:aa.name,action:aa.action,method:aa.method};var ac;if(typeof aa.elements!=="undefined"){for(var af=0;af<aa.elements.length;af++){ac=aa.elements[af];if(ac.nodeName.toLowerCase()=="select"){if(typeof ac.multiple!=="undefined"){var ab=[];if(typeof ac.options!=="undefined"){for(var ae=0;ae<ac.options.length;ae++){if(ac.options[ae].selected){ab.push(ac.options[ae].value)}}}ad["input:"+V(ac)]=ab.join()}else{ad["input:"+V(ac)]=ac.options[ac.selectedIndex].value}}else{if(ac.nodeName.toLowerCase()=="input"){if(typeof ac.type!=="undefined"){if(ac.type.toLowerCase()=="checkbox"||ac.type.toLowerCase()=="radio"){if(typeof ac.checked!=="undefined"){ad["input:"+V(ac)]=ac.value}}else{ad["input:"+V(ac)]=ac.value}}else{ad["input:"+V(ac)]=ac.value}}else{if(ac.nodeName.toLowerCase()=="textarea"){ad["input:"+V(ac)]=ac.value}else{if(typeof ac.value!=="undefined"){ad["input:"+V(ac)]=ac.value}}}}}}G.add_event({key:"formSubmit",segmentation:ad});G.end_session();j(ag);setTimeout(function(){aa.submit()},1000)}})}function X(){if(typeof W.getElementsByTagName!=="undefined"){var Z=W.getElementsByTagName("form");for(var aa=0;aa<Z.length;aa++){Y(Z[aa])}}else{q("Can't track forms")}}if(document.readyState==="complete"){X()}else{D(window,"load",X)}};function A(){if(t){if(!a){p()}var V={name:t,segment:a};G.add_event({key:"[CLY]_view",dur:u()-h,segmentation:V});t=null}}function b(W){if(G.ignore_bots&&B){return}if(!G.app_key||!G.device_id){q("app_key or device_id is missing");return}W.app_key=G.app_key;W.device_id=G.device_id;if(G.country_code){W.country_code=G.country_code}if(G.city){W.city=G.city}if(G.ip_address!==null){W.ip_address=G.ip_address}W.timestamp=u();var V=new Date();W.hour=V.getHours();W.dow=V.getDay();N.push(W);d("cly_queue",N,true)}function g(){if(typeof G.q!=="undefined"&&G.q.length>0){var Z;for(var X=0;X<G.q.length;X++){Z=G.q[X];q("Processing queued call",Z);if(typeof Z==="function"){Z()}else{if(Z.constructor===Array&&Z.length>0){if(typeof G[Z[0]]!=="undefined"){G[Z[0]].apply(null,Z.slice(1))}else{var V=Z[0].replace("userData.","");if(typeof G.userData[V]!=="undefined"){G.userData[V].apply(null,Z.slice(1))}}}}}G.q=[]}if(E&&i&&l){var Y=u();if(Y-O>60){G.session_duration(Y-O);O=Y}}if(s.length>0){if(s.length<=10){b({events:JSON.stringify(s)});s=[]}else{var W=s.splice(0,10);b({events:JSON.stringify(W)})}}if(N.length>0&&x&&u()>H){x=false;var aa=N.shift();q("Processing request",aa);w(aa,function(ab,ac){q("Request Finished",ac,ab);if(ab){N.unshift(ac);d("cly_queue",N,true);H=u()+U}x=true});d("cly_queue",N,true)}setTimeout(g,e)}function S(){var V=d("cly_id")||z();d("cly_id",V);return V}function z(){var W=new Date().getTime();var V="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(Y){var X=(W+Math.random()*16)%16|0;W=Math.floor(W/16);return(Y=="x"?X:(X&3|8)).toString(16)});return V}function p(){var af={};af._app_version=G.app_version;if(screen.width){var W=(screen.width)?screen.width:"";var ai=(screen.height)?screen.height:"";af._resolution=""+W+"x"+ai}var ah=navigator.appVersion;var ad=navigator.userAgent;var ab=navigator.appName;var aj,X;if(ad.indexOf("Opera Mini")!=-1){ab="Opera Mini"}else{if(ad.indexOf("Opera")!=-1){ab="Opera"}else{if(ad.indexOf("MSIE")!=-1){ab="Internet Explorer"}else{if(ad.indexOf("IEMobile")!=-1){ab="IE Mobile"}else{if(ad.indexOf("Chrome")!=-1){ab="Chrome"}else{if(ad.indexOf("Safari")!=-1){ab="Safari"}else{if(ad.indexOf("Firefox")!=-1){ab="Firefox"}else{if(ad.indexOf("Trident/")!=-1){ab="Internet Explorer"}else{if(ad.indexOf("FBAN/")!=-1){ab="Facebook app"}else{if((aj=ad.lastIndexOf(" ")+1)<(X=ad.lastIndexOf("/"))){ab=ad.substring(aj,X);if(ab.toLowerCase()==ab.toUpperCase()){ab=navigator.appName}}}}}}}}}}}af._browser=ab;var Y="unknown";var ae=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Windows Phone",r:/Windows Phone/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OSX",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"SearchBot",r:Q}];for(var V in ae){var ac=ae[V];if(ac.r.test(ad)){Y=ac.s;break}}var Z="unknown";if(/Windows/.test(Y)&&Y!="Windows Phone"){Z=/Windows (.*)/.exec(Y)[1];Y="Windows"}switch(Y){case"Mac OSX":Z=/Mac OS X (10[\.\_\d]+)/.exec(ad)[1];break;case"Windows Phone":Z=(/Windows Phone ([\.\_\d]+)/.exec(ad)||["","8.0"])[1];break;case"Android":Z=/Android ([\.\_\d]+)/.exec(ad)[1];break;case"iOS":Z=/OS (\d+)_(\d+)_?(\d+)?/.exec(ah);Z=Z[1]+"."+Z[2]+"."+(Z[3]|0);break}af._os=Y;a=Y;af._os_version=Z;var ag=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;if(typeof ag!=="undefined"){af._locale=ag}if(typeof document.referrer!=="undefined"&&document.referrer.length){var aa=C.exec(document.referrer);if(aa&&aa[11]&&aa[11]!=window.location.hostname){af._store=document.referrer}}q("Got metrics",af);return af}function q(){if(G.debug&&typeof console!=="undefined"){if(arguments[1]&&typeof arguments[1]=="object"){arguments[1]=JSON.stringify(arguments[1])}console.log(Array.prototype.slice.call(arguments).join("\n"))}}function u(){return Math.floor(new Date().getTime()/1000)}function M(X,ae,Z){Z=Z||k;var ad="";if(typeof X==="object"){if(typeof X.stack!=="undefined"){ad=X.stack}else{if(typeof X.name!=="undefined"){ad+=X.name+":"}if(typeof X.message!=="undefined"){ad+=X.message+"\n"}if(typeof X.fileName!=="undefined"){ad+="in "+X.fileName+"\n"}if(typeof X.lineNumber!=="undefined"){ad+="on "+X.lineNumber}if(typeof X.columnNumber!=="undefined"){ad+=":"+X.columnNumber}}}else{ad=X+""}ae=(ae)?true:false;var ac=p();var V={_os:ac._os,_os_version:ac._os_version,_resolution:ac._resolution,_error:ad,_app_version:ac._app_version,_run:u()-n};V._not_os_specific=true;var aa=navigator.battery||navigator.webkitBattery||navigator.mozBattery||navigator.msBattery;if(aa){V._bat=Math.floor(aa.level*100)}if(typeof navigator.onLine!=="undefined"){V._online=(navigator.onLine)?true:false}V._background=(document.hasFocus())?false:true;if(I.length>0){V._logs=I.join("\n")}I=[];V._nonfatal=ae;V._view=(window.location.pathname||"")+(window.location.search||"")+(window.location.hash||"");V._browser=ac._browser;if(typeof Z!=="undefined"){V._custom=Z}try{var W=document.createElement("canvas");var Y=W.getContext("experimental-webgl");V._opengl=Y.getParameter(Y.VERSION)}catch(ab){}b({crash:JSON.stringify(V)})}function w(X,Y){try{q("Sending XML HTTP request");var W=window.XMLHttpRequest?new window.XMLHttpRequest():window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null;W.open("GET",G.url+T+"?"+v(X),true);W.onreadystatechange=function(){if(this.readyState===4&&this.status>=200&&this.status<300){if(typeof Y==="function"){Y(false,X)}}else{if(this.readyState===4){q("Failed Server XML HTTP request",this.status);if(typeof Y==="function"){Y(true,X)}}}};W.send()}catch(V){q("Failed XML HTTP request",V);if(typeof Y==="function"){Y(true,X)}}}function v(X){var W=[];for(var V in X){if(V=="app_key"){W.push(V+"="+X[V])}else{W.push(V+"="+encodeURIComponent(X[V]))}}return W.join("&")}function o(V){if(V.substr(V.length-1)=="/"){return V.substr(0,V.length-1)}return V}function F(Z,X){var V={};var Y;for(var W=0;W<X.length;W++){Y=X[W];if(typeof Z[Y]!=="undefined"){V[Y]=Z[Y]}}return V}var D=function(V,W,X){if(typeof V.addEventListener!=="undefined"){V.addEventListener(W,X,false)}else{V.attachEvent("on"+W,X)}};var f=function(V){if(!V){return window.event.srcElement}else{if(typeof V.target!=="undefined"){return V.target}else{return V.srcElement}}};var j=function(V){if(typeof window.event!=="undefined"){window.event.returnValue=false}else{if(typeof V.preventDefault!=="undefined"){V.preventDefault()}else{V.returnValue=false}}};function r(V){if(typeof V.pageY=="undefined"&&typeof V.clientX=="number"&&document.documentElement){V.pageX=V.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;V.pageY=V.clientY+document.body.scrollTop+document.documentElement.scrollTop}return V}function m(){var V=document;return Math.max(Math.max(V.body.scrollHeight,V.documentElement.scrollHeight),Math.max(V.body.offsetHeight,V.documentElement.offsetHeight),Math.max(V.body.clientHeight,V.documentElement.clientHeight))}function P(){var V=document;return Math.max(Math.max(V.body.scrollWidth,V.documentElement.scrollWidth),Math.max(V.body.offsetWidth,V.documentElement.offsetWidth),Math.max(V.body.clientWidth,V.documentElement.clientWidth))}var d=function d(X,aa,W){W=W||false;var Y=false,Z;if(typeof localStorage!=="undefined"){Y=true;try{localStorage.setItem("testLocal",true)}catch(ac){Y=false}}if(typeof aa!=="undefined"&&aa!==null){if(typeof aa==="object"){aa=JSON.stringify(aa)}if(Y){localStorage.setItem(X,aa)}else{if(!W){V(X,aa,30)}}}if(typeof aa==="undefined"){if(Y){Z=localStorage.getItem(X)}else{if(!W){Z=ab(X)}}try{Z=JSON.parse(Z)}catch(ac){Z=Z}return Z}if(aa===null){if(Y){localStorage.removeItem(X)}else{if(!W){V(X,"",-1)}}}function V(af,ag,ah){var ae=new Date();ae.setTime(ae.getTime()+(ah*24*60*60*1000));var ad="; expires="+ae.toGMTString();document.cookie=af+"="+ag+ad+"; path=/"}function ab(ag){var ah=ag+"=";var ae=document.cookie.split(";");for(var af=0,ad=ae.length;af<ad;af++){var ai=ae[af];while(ai.charAt(0)===" "){ai=ai.substring(1,ai.length)}if(ai.indexOf(ah)===0){return ai.substring(ah.length,ai.length)}}return null}}}(window.Countly=window.Countly||{}));